<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site.title }}</title>
    <link rel="stylesheet" href="assets/essay.css">
</head>

<body>
    <main>
        <h1>
            {{ page.title }}
        </h1>
        <details class="author">
            <summary>
                {{ page.author }}
            </summary>
            <p class="author-bio">
                {{ page.author-bio }}
            </p>
        </details>

        <div class="content">
            {{ content }}
        </div>
    </main>

    <nav>
        <div id="home-link">
            <a href="index.html">MC Toolkit</a>
        </div>
        <div class="drawer">
            <ul id="menu">
                <li id="r-content">↓ ↓ ↓ Related Content ↓ ↓ ↓</li>
                <li class="bg-pk"><a href="{{ site.baseurl }}/">Are You Listening? Deep Listening as Youth Pedagogy</a>
                </li>
                <li class="bg-dg"><a href="{{ site.baseurl }}/">How Youth Workers Create Meaningful Encounters for Young
                        People</a>
                </li>
                <li class="bg-bl"><a href="{{ site.baseurl }}/">Self as Archive Erasure + World-Building</a></li>
            </ul>
            <div id="handler" aria-label="Menu toggle">
                <svg width="24" height="8" viewBox="0 0 24 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 2L12 6L22 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
        </div>
    </nav>

    <footer></footer>

    <script>
        // Lightbox
        const initLightbox = () => {
            const lightboxScroll = document.querySelector('.lightbox-scroll');
            const imgInfo = document.querySelector('.img-info');
            if (!lightboxScroll || !imgInfo) return;

            const images = Array.from(lightboxScroll.querySelectorAll('img'));
            if (images.length === 0) return;

            let currentIndex = 0;
            const totalImages = images.length;

            // Calculate positions for each image
            let imagePositions = [0]; // Start position of first image
            let totalWidth = 0;

            // Wait for images to load to get correct dimensions
            Promise.all(images.map(img => {
                return new Promise(resolve => {
                    if (img.complete) resolve(img);
                    img.onload = () => resolve(img);
                });
            })).then(loadedImages => {
                // Calculate position for each image
                loadedImages.forEach((img, i) => {
                    if (i < totalImages - 1) {
                        totalWidth += img.offsetWidth;
                        imagePositions.push(totalWidth);
                    }
                    // --- Swipe detection for mobile ---
                    let startX = 0;
                    let endX = 0;

                    lightboxScroll.addEventListener('touchstart', (e) => {
                        startX = e.touches[0].clientX;
                    });

                    lightboxScroll.addEventListener('touchmove', (e) => {
                        endX = e.touches[0].clientX;
                    });

                    lightboxScroll.addEventListener('touchend', () => {
                        let deltaX = endX - startX;

                        // Minimum swipe distance threshold (so small taps don’t trigger)
                        if (Math.abs(deltaX) > 50) {
                            if (deltaX < 0) {
                                // Swiped left → next image
                                nextImage();
                            } else {
                                // Swiped right → previous image
                                prevImage();
                            }
                        }

                        // Reset
                        startX = 0;
                        endX = 0;
                    });

                });

                // Update image credit
                const updateCredit = (index) => {
                    const credit = images[index].getAttribute('data-credit');
                    imgInfo.textContent = credit || '';
                };

                // Navigation functions
                const goToImage = (index) => {
                    currentIndex = index;
                    const offset = imagePositions[currentIndex];
                    lightboxScroll.style.transform = `translateX(-${offset}px)`;
                    updateCounter();
                    updateCredit(currentIndex);
                };

                const nextImage = () => {
                    currentIndex = (currentIndex + 1) % totalImages;
                    goToImage(currentIndex);
                };

                const prevImage = () => {
                    currentIndex = (currentIndex - 1 + totalImages) % totalImages;
                    goToImage(currentIndex);
                };

                // Update counter display
                const updateCounter = () => {
                    const counter = document.querySelector('.lightbox-counter');
                    counter.textContent = `${currentIndex + 1}/${totalImages}`;
                };

                // Add button listeners
                document.querySelector('.lightbox-button.next').addEventListener('click', nextImage);
                document.querySelector('.lightbox-button.prev').addEventListener('click', prevImage);

                // Initialize
                updateCounter();
                updateCredit(0);

            });
        };
        // Initialize lightbox
        initLightbox();

        // Add popup container to body
        const popup = document.createElement('div');
        popup.className = 'popup';
        document.body.appendChild(popup);

        // Handle image clicks
        document.querySelectorAll('.content img').forEach(img => {
            img.addEventListener('click', () => {
                popup.innerHTML = '';

                const popupImg = document.createElement('img');
                popupImg.src = img.src;

                const credit = document.createElement('div');
                credit.className = 'credit';
                credit.textContent = img.alt || '';

                popup.appendChild(popupImg);
                popup.appendChild(credit);
                popup.classList.add('active');
            });
        });

        // Close popup when clicking
        popup.addEventListener('click', (e) => {
            if (e.target === popup) {   // only close if click backdrop, not image
                popup.classList.remove('active');
            }
        });

        // Bubble text animation
        if (document.querySelectorAll('.bubble').length > 0) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    } else {
                        entry.target.classList.remove('visible');
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '-50px'
            });

            document.querySelectorAll('.bubble').forEach((bubble) => {
                observer.observe(bubble);
            });
        }

        // Navbar drawer
        const initDrawer = () => {
            const drawer = document.querySelector('.drawer');
            const handler = document.querySelector('#handler');

            if (!drawer || !handler) return;

            const toggleDrawer = () => {
                drawer.classList.toggle('open');
            };

            const handleOutsideClick = (e) => {
                const isClickInside = drawer.contains(e.target);
                if (!isClickInside && drawer.classList.contains('open')) {
                    drawer.classList.remove('open');
                }
            };

            handler.addEventListener('click', toggleDrawer);
            document.addEventListener('click', handleOutsideClick);
            drawer.addEventListener('click', (e) => e.stopPropagation());
        };

        // Initialize drawer
        initDrawer();
    </script>
</body>

</html>